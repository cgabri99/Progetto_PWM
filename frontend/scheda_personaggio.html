<!doctype html>
<html lang="it" data-bs-theme="dark">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scheda personaggio</title>
    <script type="text/javascript" src="../backend/script.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body onload="aggiorna(); aggiornaPagina()">
    <nav class="navbar bg-dark border-bottom border-body navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">Album delle Figurine dei Super Eroi (AFSE)</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a id="menuFigurine" class="nav-link dropdown-toggle disabled" href="#" role="button"
                            data-bs-toggle="dropdown">
                            Gestione figurine
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="album.html">Album</a></li>
                            <li><a class="dropdown-item" href="crea_scambio.html">Crea Scambio</a></li>
                            <li><a class="dropdown-item" href="lista_scambi.html">Scambi disponibili</a></li>
                            <li><a class="dropdown-item" href="acquisto_bustine.html">Acquisto bustine</a></li>
                            <li><a class="dropdown-item" href="maxi_pacchetti.html">Maxi pacchetti</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a id="menuUtente" class="nav-link dropdown-toggle disabled" href="#" role="button"
                            data-bs-toggle="dropdown">
                            Gestione utente
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="modifica_utente.html">Modifica dati</a></li>
                            <li><a class="dropdown-item" href="elimina_utente.html">Elimina Utente</a></li>
                            <li><a class="dropdown-item" href="#" onclick="sign_out();">Log out</a></li>
                            <li><a class="dropdown-item" href="login.html">Log in</a></li>
                        </ul>
                    </li>
                </ul>
                <span id="benvenuto" class="navbar-text mx-3 d-none"></span>
                <a id="salvadanaio" class="btn btn-outline-light d-none" type="button" href="acquisto_crediti.html"></a>
            </div>
        </div>
    </nav>
    <div id="container" class="container">
        <h1 class="text-center my-2">Descrizione personaggio</h1>

        <div id="placeholder" class="card m-3">
            <div class="row">
                <div class="col-md-4">
                    <div class="figure">
                        <img class="rounded-start figure-img" src="https://placehold.co/450X750/4A4E52/4A4E52/png">
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title">
                            <span class="placeholder col-6"></span>
                        </h5>
                        <p class="card-text">
                        <p class="card-text placeholder-glow">
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div id="heroCard" class="card d-none m-3">
            <div class="row g-0">
                <div class="col-md-4">
                    <img class="img-fluid rounded-start" alt="...">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title"></h5>
                        <p class="card-text"></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row row-cols-lg-3 row-cols-md-2 row-cols-1">
            <div id="col_comics" class="col">
                <div id="placeholder_comics">
                    <h1 class="placeholder-glow">
                        <span class="placeholder col-12"></span>
                    </h1>
                    <figure class="figure">
                        <img src="https://placehold.co/450X600/4A4E52/4A4E52/png" class="figure-img img-fluid rounded"
                            alt="placeholder">
                    </figure>
                </div>
                <h1 id="title_comics" class="text-center my-3 d-none">Fumetti in cui appare</h1>
                <div id="carousel_comics" class="carousel slide">
                    <div id="container_comics" class="carousel-inner">
                        <div id="item_comics" class="carousel-item d-none">
                            <img src="" class="d-block img-carousel">
                        </div>
                    </div>
                    <button id="prev_comics" class="carousel-control-prev d-none" type="button"
                        data-bs-target="#carousel_comics" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button id="next_comics" class="carousel-control-next d-none" type="button"
                        data-bs-target="#carousel_comics" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>

                <!-- <div id="containerComics" class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4 mt-2 mx-1">
                    <div id="comicCard" class="col d-none" style="max-height: 30rem;">
                        <div class="card h-100">
                            <img src="" class="card-img-top" alt="...">
                            <div class="card-body">
                                <h5 class="card-title"></h5>
                                <p class="card-text"></p>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>
            <div id="col_series" class="col">
                <div id="placeholder_series">
                    <h1 class="placeholder-glow">
                        <span class="placeholder col-12"></span>
                    </h1>
                    <figure class="figure">
                        <img src="https://placehold.co/450X600/4A4E52/4A4E52/png" class="figure-img img-fluid rounded"
                            alt="placeholder">
                    </figure>
                </div>
                <h1 id="title_series" class="text-center my-3 d-none">Serie in cui appare</h1>
                <div id="carousel_series" class="carousel slide">
                    <div id="container_series" class="carousel-inner">
                        <div id="item_series" class="carousel-item d-none">
                            <img src="" class="d-block img-carousel">
                        </div>
                    </div>
                    <button id="prev_series" class="carousel-control-prev d-none" type="button"
                        data-bs-target="#carousel_series" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button id="next_series" class="carousel-control-next d-none" type="button"
                        data-bs-target="#carousel_series" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>

                <!-- <div id="containerSeries" class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4 mt-2 mx-1">
                    <div id="serieCard" class="col d-none" style="max-height: 30rem;">
                        <div class="card h-100">
                            <img src="" class="card-img-top" alt="...">
                            <div class="card-body">
                                <h5 class="card-title"></h5>
                                <p class="card-text"></p>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>

            <div id="col_events" class="col">
                <div id="placeholder_events">
                    <h1 class="placeholder-glow">
                        <span class="placeholder col-12"></span>
                    </h1>
                    <figure class="figure">
                        <img src="https://placehold.co/450X600/4A4E52/4A4E52/png" class="figure-img img-fluid rounded"
                            alt="placeholder">
                    </figure>
                </div>
                <h1 id="title_events" class="text-center my-3 d-none">Eventi in cui appare</h1>
                <div id="carousel_events" class="carousel slide">
                    <div id="container_events" class="carousel-inner">
                        <div id="item_events" class="carousel-item d-none">
                            <img src="" class="d-block img-carousel">
                        </div>
                    </div>
                    <button id="prev_events" class="carousel-control-prev d-none" type="button"
                        data-bs-target="#carousel_events" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button id="next_events" class="carousel-control-next d-none" type="button"
                        data-bs-target="#carousel_events" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>

                <!-- <div id="containerEvents" class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4 mt-2 mx-1">
                    <div id="eventCard" class="col d-none" style="max-height: 30rem;">
                        <div class="card h-100">
                            <img src="" class="card-img-top" alt="...">
                            <div class="card-body">
                                <h5 class="card-title"></h5>
                                <p class="card-text"></p>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>


        </div>
    </div>

    <script>
        function aggiorna() {
            const searchParams = new URLSearchParams(location.search);
            URI = searchParams.get('URI');

            getFromMarvel(URI, "")
                .then((result) => popolaScehda(result.data.results))
                .catch((error) => console.error(error));
        }

        function popolaScehda(dati) {
            console.log(dati);
            heroCard = document.getElementById('heroCard');
            heroCard.classList.remove('d-none');

            hero = dati[0];

            title = heroCard.getElementsByClassName('card-title')[0];
            image = heroCard.getElementsByClassName('img-fluid')[0];
            description = heroCard.getElementsByClassName('card-text')[0];

            title.innerHTML = hero.name;
            image.src = hero.thumbnail.path + "." + hero.thumbnail.extension;
            description.innerHTML = hero.description;
            document.getElementById('container').replaceChild(heroCard, document.getElementById('placeholder'));

            // richiestaMarvel(hero.comics.collectionURI, 'comicCard', 'containerComics', 'titleComics');

            // richiestaMarvel(hero.series.collectionURI, 'serieCard', 'containerSeries', 'titleSeries');

            // richiestaMarvel(hero.events.collectionURI, 'eventCard', 'containerEvents', 'titleEvents');

            richiestaMarvelCarousel(hero.comics.collectionURI, 'comics');
            richiestaMarvelCarousel(hero.series.collectionURI, 'series');
            richiestaMarvelCarousel(hero.events.collectionURI, 'events');
        }

        // function popolaMenu(data, nomeCard, nomeContainer, nomeTitolo) {
        //     //console.log(series);
        //     card = document.getElementById(nomeCard);
        //     container = document.getElementById(nomeContainer);
        //     header = document.getElementById(nomeTitolo);
        //     container.innerHTML = "";
        //     container.append(card);

        //     for (i = 0; i < data.length; i++) {
        //         element = data[i];
        //         clone = card.cloneNode(true);
        //         clone.id = 'serieClone_' + i;

        //         title = clone.getElementsByClassName('card-title')[0];
        //         // description = clone.getElementsByClassName('card-text')[0];
        //         image = clone.getElementsByClassName('card-img-top')[0];

        //         title.innerHTML = element.title;
        //         image.src = element.thumbnail.path + "." + element.thumbnail.extension;
        //         // description.innerHTML = serie.description;

        //         header.classList.remove('d-none');
        //         clone.classList.remove('d-none');
        //         card.before(clone);
        //     }
        // }

        // function richiestaMarvel(URI, nomeCard, nomeContainer, nomeTitolo) {
        //     URI = URI.slice(URI.indexOf(1) + 2);
        //     //fetch portale marvel
        //     getFromMarvel(URI, "")
        //         .then((result) => popolaMenu(result.data.results, nomeCard, nomeContainer, nomeTitolo))
        //         .catch((error) => console.error(error));
        // }

        function richiestaMarvelCarousel(URI, type) {
            URI = URI.slice(URI.indexOf(1) + 2);
            //fetch portale marvel
            getFromMarvel(URI, "")
                .then((result) => {
                    if (result.data.results.length === 0) {
                        var title = document.getElementById('title_' + type);
                        title.classList.remove('d-none');
                        title.innerHTML = `Nessun ${type} trovato`;
                    } else {
                        popolacarousel(result.data.results, type)
                    }
                })
                .catch((error) => console.error(error));
        }

        function popolacarousel(data, type) {
            console.log(data);
            slide = document.getElementById('item_' + type);
            container = document.getElementById('container_' + type);
            header = document.getElementById('title_' + type);
            btn_prev = document.getElementById('prev_' + type);
            btn_next = document.getElementById('next_' + type);
            col = document.getElementById('col_' + type);


            container.innerHTML = "";
            container.append(slide);
            for (i = 0; i < data.length; i++) {
                element = data[i];
                clone = slide.cloneNode(true);
                clone.id = 'slideClone_' + i;

                // title = clone.getElementsByClassName('carouselHeader')[0];
                // description = clone.getElementsByClassName('card-text')[0];
                image = clone.getElementsByClassName('img-carousel')[0];

                // title.innerHTML = element.title;
                image.src = element.thumbnail.path + "." + element.thumbnail.extension;
                // description.innerHTML = serie.description;

                header.classList.remove('d-none');
                clone.classList.remove('d-none');
                col.classList.remove('d-none');
                if (i === 1) {
                    btn_next.classList.remove('d-none');
                    btn_prev.classList.remove('d-none');
                }
                if (i === 0) {
                    clone.classList.add('active');
                }
                slide.before(clone);
            }
            container.removeChild(slide);
            container.removeChild(document.getElementById('placeholder_' + type));
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>